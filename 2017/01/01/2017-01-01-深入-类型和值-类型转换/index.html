<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>深入JavaScript-类型和值-类型转换 | Cosine 的博客</title>
    <meta name="author" content="ycosine">
    
    <meta name="description" content="余贤俊 | cosine 的博客">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="深入JavaScript-类型和值-类型转换"/>
    <meta property="og:site_name" content="Cosine&#39;s Blog"/>

    
    <meta property="og:image" content=""/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="Cosine&#39;s Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="indigo">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">Cosine&#39;s Blog</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            分类
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-reading " href="/reading" >
                            <i class="fa fa-book "></i>
                            
                            读书
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            关于
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            搜索
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav indigo darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="http://ww2.sinaimg.cn/small/74990035jw1f1rjkd681bj20rs0rsdhg.jpg" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">你的大名</p>
                        <p class="desc">Web前端/iOS/技术宅</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    首页
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    归档
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    分类
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-reading " href="/reading" >
                    <i class="fa fa-book "></i>
                    
                    读书
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    关于
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    搜索
                </a>
            </li>
        
    </ul>

    <ul class="side-nav indigo darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Vue/">
                    Vue <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/JavaScript/">
                    JavaScript <span class="right">4 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/页面重构/">
                    页面重构 <span class="right">2 篇</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">搜索</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper indigo">
        <span class="breadcrumb">当前位置（分类目录）</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/JavaScript/">JavaScript</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>深入JavaScript-类型和值-类型转换</h1>
    


            </div>
            <time class="pink-link-context" datetime="2016-12-31T16:00:00.000Z"><a href="/2017/01/01/2017-01-01-深入-类型和值-类型转换/">2017-01-01</a></time>

            <span id="busuanzi_container_page_pv" class="read-times-container">
    <i class="fa fa-eye"></i>
    <span id="busuanzi_value_page_pv"></span>
</span>

            
    <div class="tags-row">
        
            <a href="/tags/深入系列/" class="chip pink lighten-1">深入系列</a>
        
            <a href="/tags/JavaScript/" class="chip pink lighten-1">JavaScript</a>
        
    </div>


            <div class="toc pink-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#深入JavaScript-类型转换"><span class="section table-of-contents-text">深入JavaScript-类型转换</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#类型转换是什么？"><span class="section table-of-contents-text">类型转换是什么？</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#ToBoolean-布尔值"><span class="section table-of-contents-text">ToBoolean 布尔值</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#falsy-value-假值"><span class="section table-of-contents-text">falsy value 假值</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#补充说明-与-amp-amp"><span class="section table-of-contents-text">补充说明 || 与 &amp;&amp;</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#宽松相等-和严格相等"><span class="section table-of-contents-text">宽松相等== 和严格相等 ===</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#补充"><span class="section table-of-contents-text">补充</span></a></li></ol></li></ol>
</div>


            <div class="entry pink-link-context">
                <h1 id="深入JavaScript-类型转换"><a href="#深入JavaScript-类型转换" class="headerlink" title="深入JavaScript-类型转换"></a>深入JavaScript-类型转换</h1><blockquote>
<p>闇に惑いし哀れな影よ。你能控制，那是好的，你不能控制，那才是坏的。</p>
</blockquote>
<p>人们对JavaScript中最大的偏见,最多的指责,莫过于这强制类型转换了。<br>这里我想说的是，代码是给人看的，而不是仅仅给机器进行执行的。<br>在编码过程中尽可能将类型转换表达清楚，以免给别人留坑。<br>而不是为了在代码中”花式炫技”为了类型转换而转换，反而适得其反。</p>
<p><strong>你能控制，且能让别人看懂的，那就是优秀的</strong></p>
<a id="more"></a>
<h2 id="类型转换是什么？"><a href="#类型转换是什么？" class="headerlink" title="类型转换是什么？"></a>类型转换是什么？</h2><p>我想说一个很多人都没有搞清楚的东西。<br>什么时候会发生类型转换。</p>
<h2 id="ToBoolean-布尔值"><a href="#ToBoolean-布尔值" class="headerlink" title="ToBoolean 布尔值"></a>ToBoolean 布尔值</h2><p>ToBoolean的expression表达式情况</p>
<ul>
<li>显式的 Boolean() 以及”显式”的 !!</li>
<li>if(expression)  while(expression) for(..;expression;..;) 中的条件判断</li>
<li>三元表达式 expression?a:b</li>
<li>逻辑运算符中的 逻辑或，逻辑与 ||  &amp;&amp;  左边的操作数 ！！请注意只有左边</li>
</ul>
<h3 id="falsy-value-假值"><a href="#falsy-value-假值" class="headerlink" title="falsy value 假值"></a>falsy value 假值</h3><p>JavaScript中的值可以分为下面两类</p>
<ul>
<li>1.可以被强制类型转换为false的值</li>
<li>2.其他<br>牢记5大假值</li>
<li>undefined</li>
<li>null</li>
<li>false</li>
<li>+-0 NaN</li>
<li>“”<br>请尤其小心谨慎下面这些容易发生误会的真值</li>
<li>“false”</li>
<li>“0”</li>
<li>“‘’”</li>
<li>[]</li>
<li>{}</li>
<li>[0]</li>
<li>function(){}</li>
</ul>
<p>以上值中最坑的应该是[] {},他虽然是真值,但是在ToPromitive解析中却返回的是假值，下面会讲到这个问题</p>
<h3 id="补充说明-与-amp-amp"><a href="#补充说明-与-amp-amp" class="headerlink" title="补充说明 || 与 &amp;&amp;"></a>补充说明 || 与 &amp;&amp;</h3><p>JavaScript中的逻辑运算符和别的语言有一些重要的差别<br>它返回的并不是布尔值,可能你用过很多次都理所当然的认为是,其实只是返回后在条件表达式中理所当然的进行了隐式的布尔转换<br>它的返回值是两个操作数的一个,即选择两个操作数中的一个,所以也有人称这个运算符为选择运算符</p>
<p>首先对第一个操作数Toboolean后执行条件判断</p>
<ul>
<li>|| 如果true 返回第一个,否则第二个</li>
<li>&amp;&amp; 如果false 返回第一个,否则第二个</li>
</ul>
<h3 id="宽松相等-和严格相等"><a href="#宽松相等-和严格相等" class="headerlink" title="宽松相等== 和严格相等 ==="></a>宽松相等== 和严格相等 ===</h3><blockquote>
<p>一个常见的误区是 == 检查值是否相等, === 检查值和类型是否相等。听起来蛮有道理，但是远不够准确。<br>一个更常见的见解是把==和以上提到的真值假值混淆在了一起。</p>
</blockquote>
<p><strong>“==允许在相等比较中进行强制类型转换,而===不允许”</strong><br>这里涉及到一个很重要,但是总是有人少根筋忘记的事情。<br>a与b类型不等的时候，到底是什么类型强制转换另一种类型进行比较？</p>
<p>以下规则均套路不同类型的宽松比较情况</p>
<p>Number&gt; String<br>Number&gt; Boolean<br>ToPromitive&gt;Object</p>
<p><strong>简单说数字最大,但是数字的比较最为严格</strong></p>
<p>1.字符串和布尔值在比较中均转换toNumber继续比较<br>// 个人建议 在任何情况下都不要使用 == 布尔值,因为布尔值一定会被优先转换成数字<br>2.null 与 undefined 宽松相等,可以相互进行隐式转换<br>//但是和所谓的 “” false 不等,原因见1<br>3.对象在比较中 toprimitive操作(valueOf&gt;toString)<br>4.请时刻注意自己是在进行toNumber toBoolean toprimitive操作的哪一种<br>令人窒息的一些非常规情况</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"0"</span> == <span class="literal">false</span> <span class="comment">// true</span></span><br><span class="line"><span class="string">""</span> == <span class="literal">false</span> <span class="comment">// true</span></span><br><span class="line">[] == <span class="literal">false</span> <span class="comment">// true</span></span><br><span class="line">&#123;&#125; == <span class="literal">false</span> <span class="comment">// false</span></span><br><span class="line">[] == ![]<span class="comment">// true</span></span><br><span class="line"><span class="number">2</span> == [<span class="number">2</span>]<span class="comment">// true</span></span><br><span class="line"><span class="string">""</span> == [<span class="literal">null</span>] <span class="comment">// ture 特别提醒[null] toString 返回 "" toNumber 0</span></span><br></pre></td></tr></table></figure>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>显式类型转换发生在静态类型语言的编译时<br>强制类型转换发生在动态类型语言的运行时</p>
<p><a href="http://dorey.github.io/JavaScript-Equality-Table/" target="_blank" rel="noopener">github上的比较记忆图表</a></p>
<p>ES5规范补充</p>
<blockquote>
<p>The Equals Operator ( == )</p>
</blockquote>
<p>The production EqualityExpression : EqualityExpression == RelationalExpression is evaluated as follows:</p>
<p>Let lref be the result of evaluating EqualityExpression.<br>Let lval be GetValue(lref).<br>Let rref be the result of evaluating RelationalExpression.<br>Let rval be GetValue(rref).<br>Return the result of performing abstract equality comparison rval == lval. (see 11.9.3).<br>11.9.2 The Does-not-equals Operator ( != )</p>
<p>The production EqualityExpression : EqualityExpression != RelationalExpression is evaluated as follows:</p>
<p>Let lref be the result of evaluating EqualityExpression.<br>Let lval be GetValue(lref).<br>Let rref be the result of evaluating RelationalExpression.<br>Let rval be GetValue(rref).<br>Let r be the result of performing abstract equality comparison rval == lval. (see 11.9.3).<br>If r is true, return false. Otherwise, return true.<br>11.9.3 The Abstract Equality Comparison Algorithm</p>
<p>The comparison x == y, where x and y are values, produces true or false. Such a comparison is performed as follows:</p>
<p>If Type(x) is the same as Type(y), then<br>If Type(x) is Undefined, return true.<br>If Type(x) is Null, return true.<br>If Type(x) is Number, then<br>If x is NaN, return false.<br>If y is NaN, return false.<br>If x is the same Number value as y, return true.<br>If x is +0 and y is −0, return true.<br>If x is −0 and y is +0, return true.<br>Return false.<br>If Type(x) is String, then return true if x and y are exactly the same sequence of characters (same length and same characters in corresponding positions). Otherwise, return false.<br>If Type(x) is Boolean, return true if x and y are both true or both false. Otherwise, return false.<br>Return true if x and y refer to the same object. Otherwise, return false.<br>If x is null and y is undefined, return true.<br>If x is undefined and y is null, return true.<br>If Type(x) is Number and Type(y) is String,<br>return the result of the comparison x == ToNumber(y).<br>If Type(x) is String and Type(y) is Number,<br>return the result of the comparison ToNumber(x) == y.<br>If Type(x) is Boolean, return the result of the comparison ToNumber(x) == y.<br>If Type(y) is Boolean, return the result of the comparison x == ToNumber(y).<br>If Type(x) is either String or Number and Type(y) is Object,<br>return the result of the comparison x == ToPrimitive(y).<br>If Type(x) is Object and Type(y) is either String or Number,<br>return the result of the comparison ToPrimitive(x) == y.<br>Return false.<br>NOTE 1 Given the above definition of equality:</p>
<p>String comparison can be forced by: “” + a == “” + b.<br>Numeric comparison can be forced by: +a == +b.<br>Boolean comparison can be forced by: !a == !b.<br>NOTE 2 The equality operators maintain the following invariants:</p>
<p>A != B is equivalent to !(A == B).<br>A == B is equivalent to B == A, except in the order of evaluation of A and B.<br>NOTE 3 The equality operator is not always transitive. For example, there might be two distinct String objects, each representing the same String value; each String object would be considered equal to the String value by the == operator, but the two String objects would not be equal to each other. For Example:</p>
<p>new String(“a”) == “a” and “a” == new String(“a”)are both true.<br>new String(“a”) == new String(“a”) is false.<br>NOTE 4 Comparison of Strings uses a simple equality test on sequences of code unit values. There is no attempt to use the more complex, semantically oriented definitions of character or string equality and collating order defined in the Unicode specification. Therefore Strings values that are canonically equal according to the Unicode standard could test as unequal. In effect this algorithm assumes that both Strings are already in normalised form.</p>
<p>11.9.4 The Strict Equals Operator ( === )</p>
<p>The production EqualityExpression : EqualityExpression === RelationalExpression is evaluated as follows:</p>
<p>Let lref be the result of evaluating EqualityExpression.<br>Let lval be GetValue(lref).<br>Let rref be the result of evaluating RelationalExpression.<br>Let rval be GetValue(rref).<br>Return the result of performing the strict equality comparison rval === lval. (See 11.9.6)<br>11.9.5 The Strict Does-not-equal Operator ( !== )</p>
<p>The production EqualityExpression : EqualityExpression !== RelationalExpression is evaluated as follows:</p>
<p>Let lref be the result of evaluating EqualityExpression.<br>Let lval be GetValue(lref).<br>Let rref be the result of evaluating RelationalExpression.<br>Let rval be GetValue(rref).<br>Let r be the result of performing strict equality comparison rval === lval. (See 11.9.6)<br>If r is true, return false. Otherwise, return true.<br>11.9.6 The Strict Equality Comparison Algorithm</p>
<p>The comparison x === y, where x and y are values, produces true or false. Such a comparison is performed as follows:</p>
<p>If Type(x) is different from Type(y), return false.<br>If Type(x) is Undefined, return true.<br>If Type(x) is Null, return true.<br>If Type(x) is Number, then<br>If x is NaN, return false.<br>If y is NaN, return false.<br>If x is the same Number value as y, return true.<br>If x is +0 and y is −0, return true.<br>If x is −0 and y is +0, return true.<br>Return false.<br>If Type(x) is String, then return true if x and y are exactly the same sequence of characters (same length and same characters in corresponding positions); otherwise, return false.<br>If Type(x) is Boolean, return true if x and y are both true or both false; otherwise, return false.<br>Return true if x and y refer to the same object. Otherwise, return false.<br>NOTE This algorithm differs from the SameValue Algorithm (9.12) in its treatment of signed zeroes and NaNs.</p>

                
<p class="pink-link-context">
    <a href="/2017/01/01/2017-01-01-深入系列-类型和值(3)/" rel="next" title="深入JavaScript-类型和值-第三部分">
    上一篇：深入JavaScript-类型和值-第三部分
  </a>
</p>




            </div>
			
        </div>
    </div>
</article>






</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large pink">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect green" title="回到顶部"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse yellow darken-1"  data-activates="main-menu" title="菜单"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer indigo darken-1">
    
    <div class="footer-container container">
        <div class="row">
            
            <div class="social-group col m4 s12">
                <h5 class="white-text">社交</h5>
                
                    <a class="social-link" href="http://weibo.com/1956184117" target="_blank">
                        <i class="fa fa-2x fa-weibo"></i>
                    </a>
                
                    <a class="social-link" href="https://github.com/raytaylorlin" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
                
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
    <div class="site-visitors-container white-text">
        <span>
            <i class="fa fa-user"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
        </span>
        <span>&nbsp;|&nbsp;</span>
        <span>
            <i class="fa fa-eye"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
        </span>
    </div>


            </div>
            

            
            <div class="col m8 s12">
                <h5 class="white-text">友情链接</h5>
                
                    <a class="social-link" href="http://raytaylorlin.com/" target="_blank">raytaylorism主题作者的技术博客</a>
                
                    <a class="social-link" href="https://github.com/raytaylorlin" target="_blank">Github地址（测试友情链接）</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright pink-link-context">
        <div class="container">
            © 2016 example.com, All rights reserved.
            <p class="right" style="margin-top: 0;">本博客由 <a href="https://hexo.io">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();

            // 目录随屏幕滚动（防止目录过长越过footer）
            var $toc = $('.toc');
            var scrollTargetTop = 0;
            $(window).scroll(function() {
                var $activeLink = $toc.find('a.active.section');
                if ($(window).scrollTop() < 100) {
                    scrollTargetTop = 0;
                } else {
                    if ($activeLink[0]) {
                        scrollTargetTop = $activeLink.offset().top - $toc.offset().top;
                    }
                }
                $toc.css('top', '-' + scrollTargetTop + 'px');
            });

            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('pink lighten-2');

            
            // 添加new标签
            $('').append('<span class="new badge pink"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "search.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



</body>
</html>
